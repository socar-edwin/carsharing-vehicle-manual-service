# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

**ì¹´ì…°ì–´ë§(Car-sharing) ì°¨ëŸ‰ ë§¤ë‰´ì–¼ RAG Chatbot** - ì°¨ëŸ‰ë³„ ì¡°ì‘ ë°©ë²•ì„ ì•ˆë‚´í•˜ëŠ” AI ì±—ë´‡

ì‚¬ìš©ìê°€ ì°¨ì¢…ì„ ì„ íƒí•˜ë©´ í•´ë‹¹ ì°¨ëŸ‰ì˜ ë§¤ë‰´ì–¼ì—ì„œ ì‹œë™, ì£¼ìœ /ì¶©ì „, ë¸”ë£¨íˆ¬ìŠ¤, íŠ¸ë í¬ ë“± ì¡°ì‘ ë°©ë²•ì„ ìì—°ì–´ë¡œ ë‹µë³€í•©ë‹ˆë‹¤.

## Project Status

**Current Phase**: Production Ready (app_vehicle.py)

### ì£¼ìš” ê¸°ëŠ¥
- âœ… ì°¨ëŸ‰ ë§¤ë‰´ì–¼ RAG ì±—ë´‡ (ChromaDB + OpenAI)
- âœ… car_class_id URL íŒŒë¼ë¯¸í„° ì§€ì› (ì•± ì—°ë™)
- âœ… ì „ê¸°ì°¨/ì¼ë°˜ì°¨ ìë™ ê°ì§€ (FAQ ë™ì  ë³€ê²½)
- âœ… Heading ID ê¸°ë°˜ ì¶œì²˜ ë§í¬ (ì •í™•í•œ ì„¹ì…˜ ì´ë™)
- âœ… SOCAR ë¸Œëœë”© (ë¡œê³ , ì‹œê·¸ë‹ˆì²˜)
- âœ… ëª¨ë°”ì¼ ë°˜ì‘í˜• UI

## Quick Start

### 1. Install Dependencies
```bash
pip install -r requirements.txt
```

### 2. Configure Environment
```bash
cp .env.example .env
# Edit .env:
# - OPENAI_API_KEY (required)
```

### 3. Run Vehicle Manual Chatbot
```bash
streamlit run app_vehicle.py
# http://localhost:8501
```

### 4. URL Parameter ì—°ë™ (ì•±ì—ì„œ í˜¸ì¶œ ì‹œ)
```
http://localhost:8501/?car_class_id=368
```
- car_class_idê°€ ìˆìœ¼ë©´ ìë™ìœ¼ë¡œ í•´ë‹¹ ì°¨ì¢… ì„ íƒ
- ì‚¬ì´ë“œë°” ìˆ¨ê¹€, í•´ë‹¹ ì°¨ì¢… ì „ìš© UI í‘œì‹œ

## Project Structure

```
vehicle-info-chatbot/
â”œâ”€â”€ app_vehicle.py              # ğŸš€ ë©”ì¸ ì•± (Vehicle Manual Chatbot)
â”œâ”€â”€ config.py                   # í™˜ê²½ ì„¤ì •
â”œâ”€â”€ requirements.txt            # Python ì˜ì¡´ì„± (app_vehicle.py ì „ìš©)
â”‚
â”œâ”€â”€ src/                        # Core modules
â”‚   â”œâ”€â”€ vehicle_chatbot.py      # LLM ì±—ë´‡ ë¡œì§
â”‚   â”œâ”€â”€ vehicle_retriever.py    # ì°¨ëŸ‰ ë§¤ë‰´ì–¼ ê²€ìƒ‰
â”‚   â”œâ”€â”€ vehicle_indexing.py     # ChromaDB ì¸ë±ìŠ¤
â”‚   â””â”€â”€ vehicle_data_loader.py  # CSV ë¡œë”
â”‚
â”œâ”€â”€ data/                       # ë°ì´í„° (3ê°œ íŒŒì¼)
â”‚   â”œâ”€â”€ vehicle_manual_data.csv           # ì°¨ëŸ‰ ë§¤ë‰´ì–¼ (105ê°œ ì°¨ì¢…)
â”‚   â”œâ”€â”€ car_class_manual_mapping.csv      # car_class_id â†’ ë§¤ë‰´ì–¼ ë§¤í•‘ (128ê°œ)
â”‚   â””â”€â”€ help_center_carsharing_only_*.csv # Help Center ë°ì´í„°
â”‚
â”œâ”€â”€ img/                        # ì´ë¯¸ì§€ ì—ì…‹
â”‚   â”œâ”€â”€ Socar_Symbol_RGB.png    # ì˜ì¹´ ì‹¬ë³¼ (ì•„ë°”íƒ€, íŒŒë¹„ì½˜)
â”‚   â””â”€â”€ Socar_Signature_WhiteBG_RGB.png  # ì˜ì¹´ ì‹œê·¸ë‹ˆì²˜ (í—¤ë”)
â”‚
â”œâ”€â”€ vectorstore/                # ChromaDB ë²¡í„° ì¸ë±ìŠ¤
â”‚   â””â”€â”€ vehicle_manuals_chroma/ # ì°¨ëŸ‰ ë§¤ë‰´ì–¼ ë²¡í„° (5,613 chunks)
â”‚
â”œâ”€â”€ api/                        # [ì„ íƒ] Help Center Search API
â”‚   â””â”€â”€ search_api.py
â”œâ”€â”€ app.py                      # [ì„ íƒ] Help Center Chatbot UI
â”‚
â””â”€â”€ docs/                       # ë¬¸ì„œ
    â”œâ”€â”€ DESIGN_PROPOSAL.md
    â”œâ”€â”€ RAG_RESEARCH.md
    â””â”€â”€ VEHICLE_CHATBOT_DESIGN.md
```

## Architecture: Vehicle Manual Chatbot

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â‘  car_class_id íŒŒë¼ë¯¸í„° ì…ë ¥       â”‚  URL: ?car_class_id=368
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â‘¡ ë§¤í•‘ í…Œì´ë¸” ì¡°íšŒ                  â”‚  car_class_manual_mapping.csv
â”‚  car_class_id â†’ vehicle_name        â”‚  ì˜ˆ: 368 â†’ "EV6"
â”‚  + vehicle_type (ì „ê¸°ì°¨/SUV ë“±)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â‘¢ ì°¨ì¢… ë§¤ë‰´ì–¼ ë¡œë“œ                  â”‚  ChromaDB Metadata Filter
â”‚  vehicle_nameìœ¼ë¡œ í•„í„°ë§             â”‚  ì˜ˆ: vehicle_name="EV6"
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â‘£ ì‚¬ìš©ì ì§ˆë¬¸ ì…ë ¥                  â”‚  "ì¶©ì „êµ¬ ì–´ë””ì•¼?"
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â‘¤ Query Analysis (LLM)            â”‚
â”‚  - í‚¤ì›Œë“œ ì¶”ì¶œ: "ì¶©ì „êµ¬" â†’ "ì¶©ì „êµ¬"   â”‚
â”‚  - ì„œë¹„ìŠ¤ ë¬¸ì˜ ì—¬ë¶€ íŒë‹¨             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â‘¥ LLM ë‹µë³€ ìƒì„± (GPT-4o-mini)     â”‚
â”‚  ë§¤ë‰´ì–¼ ì»¨í…ìŠ¤íŠ¸ ê¸°ë°˜ ë‹µë³€           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â‘¦ Heading ID ë§¤ì¹­                  â”‚  Score ê¸°ë°˜ ìš°ì„ ìˆœìœ„
â”‚  "ì¶©ì „êµ¬" â†’ "ì¶©ì „êµ¬ ê°œí" ì„¹ì…˜       â”‚  (êµ¬ì²´ì  > ê³µí†µ ì•ˆë‚´)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â‘§ ë‹µë³€ + ì¶œì²˜ URL ë°˜í™˜             â”‚
â”‚  URL#heading_id (ì„¹ì…˜ ë°”ë¡œê°€ê¸°)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Key Features

### 1. car_class_id URL íŒŒë¼ë¯¸í„°
ì•±ì—ì„œ ì±—ë´‡ í˜¸ì¶œ ì‹œ car_class_idë¥¼ ì „ë‹¬í•˜ë©´ ìë™ìœ¼ë¡œ í•´ë‹¹ ì°¨ì¢… ì„ íƒ:
```
http://localhost:8501/?car_class_id=368
```

**ë§¤í•‘ íŒŒì¼**: `data/car_class_manual_mapping.csv`
```csv
car_class_id,car_name,manual_vehicle_name,vehicle_type
368,EV6 ë¡±ë ˆì¸ì§€,EV6,ì „ê¸°ì°¨
695,GV70,GV70,SUV
```

### 2. ì „ê¸°ì°¨/ì¼ë°˜ì°¨ ë™ì  FAQ
- ì „ê¸°ì°¨: "ì¶©ì „êµ¬ ìœ„ì¹˜", "ì¶©ì „ ë°©ë²•"
- ì¼ë°˜ì°¨: "ì£¼ìœ êµ¬ ìœ„ì¹˜", "ê¸°ì–´ ì¡°ì‘ë²•"

### 3. Heading ID ìš°ì„ ìˆœìœ„ ë§¤ì¹­
`find_heading_id_by_keyword()` í•¨ìˆ˜ê°€ êµ¬ì²´ì ì¸ ì„¹ì…˜ì„ ìš°ì„  ë§¤ì¹­:
- "ì£¼ìœ " ê²€ìƒ‰ â†’ "ì£¼ìœ êµ¬ ê°œí" (O) vs "ì˜ì¹´ ì°¨ëŸ‰ ê³µí†µ ì•ˆë‚´(ì£¼ìœ )" (X)
- Score ê³„ì‚°: êµ¬ì²´ì  í‚¤ì›Œë“œ +50, ê³µí†µ ì•ˆë‚´ -30

### 4. SOCAR ë¸Œëœë”©
- í˜ì´ì§€ ì•„ì´ì½˜: `img/Socar_Symbol_RGB.png`
- í—¤ë” ì‹œê·¸ë‹ˆì²˜: `img/Socar_Signature_WhiteBG_RGB.png` (ìš°ì¸¡ ìƒë‹¨ ê³ ì •)
- ì–´ì‹œìŠ¤í„´íŠ¸ ì•„ë°”íƒ€: SOCAR ì‹¬ë³¼

### 5. ëª¨ë°”ì¼ ë°˜ì‘í˜•
- FAQ ì¹©: ê°€ë¡œ ë°°ì¹˜ ìœ ì§€ (CSS `flex-direction: row`)
- ì‹œê·¸ë‹ˆì²˜: ëª¨ë°”ì¼ì—ì„œ ì‘ê²Œ í‘œì‹œ (20px)

## Configuration

### Environment Variables (`.env`)
```bash
OPENAI_API_KEY=sk-...  # Required
```

### `config.py` ì£¼ìš” ì„¤ì •
| ì„¤ì • | ê°’ | ì„¤ëª… |
|------|-----|------|
| `EMBEDDING_MODEL` | `text-embedding-3-large` | OpenAI ì„ë² ë”© |
| `EMBEDDING_DIMENSIONS` | `1536` | ë²¡í„° ì°¨ì› |

## Code Reference

### ì£¼ìš” íŒŒì¼ ë° í•¨ìˆ˜

**app_vehicle.py**:
- `load_car_class_mapping()`: car_class_id ë§¤í•‘ ë¡œë“œ
- `get_vehicle_from_car_class_id()`: ë§¤í•‘ ì¡°íšŒ

**src/vehicle_chatbot.py**:
- `chat()`: ë©”ì¸ ì±—ë´‡ ë¡œì§
- `_analyze_query()`: LLM ì¿¼ë¦¬ ë¶„ì„
- `find_heading_id_by_keyword()`: Heading ID ìš°ì„ ìˆœìœ„ ë§¤ì¹­
- `add_text_highlight_to_url()`: URLì— ì„¹ì…˜ ì•µì»¤ ì¶”ê°€

**src/vehicle_retriever.py**:
- `get_vehicle_document()`: ì°¨ì¢…ë³„ ë§¤ë‰´ì–¼ ë¡œë“œ
- `format_context_for_llm()`: LLM ì»¨í…ìŠ¤íŠ¸ í¬ë§·íŒ…

## Rebuilding Vector Index

ë°ì´í„° ë³€ê²½ ì‹œ:
```bash
python -m src.vehicle_indexing
```

## Security Notes

- âœ… ëª¨ë“  ê²½ë¡œëŠ” ìƒëŒ€ ê²½ë¡œ (`Path(__file__).parent`)
- âœ… API í‚¤ëŠ” í™˜ê²½ë³€ìˆ˜ë¡œë§Œ ë¡œë“œ
- âš ï¸ `config.py`ì˜ Zendesk ê¸°ë³¸ê°’ ì œê±° í•„ìš” (ë³´ì•ˆ)

## Related Files

- `DESIGN_PROPOSAL.md`: ì‹œìŠ¤í…œ ì„¤ê³„ ë¬¸ì„œ
- `RAG_RESEARCH.md`: RAG ê¸°ìˆ  ì—°êµ¬
- `VEHICLE_CHATBOT_DESIGN.md`: ì°¨ëŸ‰ ì±—ë´‡ ì„¤ê³„
